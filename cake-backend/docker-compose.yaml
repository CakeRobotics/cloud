version: '3.7'

volumes:
    auth-db:

services:
    reverse-proxy:
        container_name: cake-core-nginx
        image: nginx
        ports:
            - 127.0.0.1:${LISTEN_PORT}:80
        restart: always
        volumes:
            - ./nginx.conf:/etc/nginx/nginx.conf:ro

    auth:
        image: images.cakerobotics.com/mostafa/auth:latest
        container_name: cake-auth
        depends_on:
            - auth-db
        environment:
            POSTGRES_HOST: auth-db
            POSTGRES_USER: cake
            POSTGRES_PASSWORD: ${AUTH_POSTGRES_PASSWORD}
            POSTGRES_DB: auth
            JWT_SECRET: ${AUTH_JWT_SECRET}
            REQUIRE_REGISTERATION_TOKEN: ${REQUIRE_REGISTERATION_TOKEN}
            ADMIN_USERNAME: ${ADMIN_USERNAME}
            ADMIN_PASSWORD: ${ADMIN_PASSWORD}
            ADMIN_EMAIL: ${ADMIN_EMAIL}
        restart: always
        volumes:
            - /etc/timezone:/etc/timezone:ro
            - /etc/localtime:/etc/localtime:ro

    auth-db:
        image: postgres
        container_name: cake-auth-db
        environment:
            POSTGRES_USER: cake
            POSTGRES_PASSWORD: ${AUTH_POSTGRES_PASSWORD}
            POSTGRES_DB: auth
        restart: always
        volumes:
            - auth-db:/var/lib/postgresql/data
            - /etc/timezone:/etc/timezone:ro
            - /etc/localtime:/etc/localtime:ro
